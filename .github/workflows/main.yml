name: Sync Repositories

on: workflow_dispatch

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      # 1. æ£€å‡ºä»£ç 
      - uses: actions/checkout@v4
        
      # 2. é…ç½®Git
      - name: Setup Git
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
      # 3. æ‰¹é‡åŒæ­¥å¤šä¸ªä»“åº“
      - name: Sync multiple repositories
        run: |
          echo "=== å¼€å§‹æ‰¹é‡åŒæ­¥ ==="
          
          # è¦åŒæ­¥çš„ä»“åº“åˆ—è¡¨ï¼ˆæ ¼å¼ï¼šæ–‡ä»¶å¤¹å:ä»“åº“URLï¼‰
          repos=(
            # åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šä»“åº“
           # "KWL:https://github.com/kimwang1978/collect-txt.git"
           # "MYTV:https://github.com/cyalias/mytvs-github.git"
           # "IPTV:https://github.com/Guovin/iptv-api.git"
           # "FREEBOX:https://github.com/kknifer7/FreeBox.git"
           # "HD9B:https://github.com/hd9211/Tvbox1.git"
           # "TVURL:https://github.com/ne7359/tvurl.git"
           # "LSTG:https://github.com/ls125781003/tvboxtg.git"
           # "JADR:https://github.com/jak0099/dr.git"
           # "NSFW:https://github.com/CatVodSpider-GM/SFW-Spiders.git"
           # "NSFW/DOC:https://github.com/CatVodSpider-GM/docs.git"
           "NSFW/NSFW:https://github.com/CatVodSpider-GM/NSFW-Spiders.git"

          )
          
          for repo in "${repos[@]}"; do
            # è§£ææ–‡ä»¶å¤¹åå’ŒURL
            folder="${repo%%:*}"
            url="${repo#*:}"
            
            echo ""
            echo "ğŸ”„ åŒæ­¥: $folder"
            echo "æºä»“åº“: $url"
            
            # åˆ›å»ºä¸´æ—¶ç›®å½•
            tmp=$(mktemp -d)
            
            # å…‹éš†å¹¶å¤åˆ¶
            if git clone --depth 1 "$url" "$tmp" 2>/dev/null; then
              # å‡†å¤‡ç›®æ ‡æ–‡ä»¶å¤¹
              mkdir -p "$folder"
              rm -rf "$folder"/*
              
              # å¤åˆ¶æ–‡ä»¶
              cp -r "$tmp"/* "$folder"/ 2>/dev/null || true
              
              # ç»Ÿè®¡ç»“æœ
              count=$(find "$folder" -type f 2>/dev/null | wc -l)
              echo "âœ… æˆåŠŸ ($count ä¸ªæ–‡ä»¶)"
            else
              echo "âŒ å¤±è´¥"
            fi
            
            # æ¸…ç†
            rm -rf "$tmp"
          done
          
          echo ""
          echo "=== åŒæ­¥å®Œæˆ ==="
          
      # 4. æäº¤å’Œæ¨é€
      - name: Commit and push
        run: |
          # æ·»åŠ æ›´æ”¹
          git add .
          
          # æäº¤ï¼ˆä½¿ç”¨å®‰å…¨çš„ä¿¡æ¯ï¼‰
          git commit -m "Sync update" || exit 0
          
          # æ¨é€
          echo "æ¨é€åˆ°ä»“åº“..."
          git push
          
          echo ""
          echo "âœ… åŒæ­¥å®Œæˆå¹¶å·²æ¨é€ï¼"
          echo "ğŸ‘‰ æŸ¥çœ‹æ›´æ–°: https://github.com/${{ github.repository }}"
